doctype html
html

  head
    title= title
    link(rel='stylesheet', href='/materialize/css/materialize.min.css')
    link(rel='stylesheet', href='/stylesheets/style.css')
    link(rel='stylesheet' href='https://fonts.googleapis.com/icon?family=Material+Icons')
    script(src='/materialize/js/jquery-3.1.1.min.js')
    script(src='/materialize/js/materialize.min.js')
    
  body

    ul(id="dropdown1" class="dropdown-content")
      li
        a(href="/mylist") My Watch List
      li(class="divider")
      li
        a(href="/logout") Log out
  
    nav(class='index-nav')
      .nav-wrapper
        ul(id='nav-mobile', class='right hide-on-med-and-down')
          li
            //- log in/out btns
            if logged_in_user
              a(class="dropdown-button waves-effect waves-light btn btn-index" href="#!" data-activates="dropdown1") 
                = logged_in_user
            else
              a(class='waves-effect waves-light btn btn-index' href='#modal-login') Log in

    //- search
    .container(style='margin-top: 10%')
      div.center(style='margin-left: 40px')
        img(src='logo.png')
      .row(style='margin-top: 4%')
        form(class='search-container' method='get', action='/search', id='search')
          input(type="text" class="search-bar autocomplete" id='search_text', name='search_text', placeholder="Search by City/State or Zipcode", autocomplete="off")
          ul(class="autocomplete-content dropdown-content" id="autocomplete")
          //- a(href="#" style='color: #26a69a')
          //-   i(class='search-icon material-icons')
          //-     = 'search'
    
    include user.jade
    
    script.
      $(document).ready(function(){
        //- autocomplete
        function insertAutocomplete(array) {
          var ele_string = '';
          for (var i = 0; i < array.length; i++) {
            ele_string += '<li><span>' + array[i] + '</span></li>';
          }
          $("#autocomplete").html(ele_string);
        }
        
        $('#search_text').keyup(function() {
          //- $('.autocomplete-content').remove();
          
          var query = $(this).val();
          
          var getting = $.get('/autocomplete', {
            query: query
          });
          
          getting.done(function(response) {
            console.log(response);
            if (response.length > 0) {
              insertAutocomplete(response);
            } else {
              $('#autocomplete').html("");
            }
          });
        });
        
        $(document).on('click', 'ul#autocomplete > li', function(event) {
          var text = $(this).children().text();
          $('#search_text').val(text);
          $('#autocomplete').html("");
        });
        
        $('#search_text').blur(function() {
          $('#autocomplete').html("");
        })
      });
